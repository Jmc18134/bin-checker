use reqwest;
use select::document::Document;
use select::predicate::Class;

fn main() { 
    check_bins("https://eastrenfrewshire.gov.uk/article/1555/When-is-my-bin-emptied?uprn=131009018#bins");
}

fn check_bins(url: &str) {
    // Get the document
    let resp = reqwest::get(url).unwrap();
    let document = Document::from_read(resp).unwrap();
    
    let next_collection = document.find(Class("next-collection")).next().unwrap();
    // Get the date of the collection
    let collection_date = next_collection.find(Class("bins-date")).next().unwrap().text();
    
    // Extract the colour of the bins for that collection
    let mut target_bins = String::from("");
    let bin_colours = ["green", "brown", "grey", "blue"];

    for node in next_collection.children() {
        for colour in bin_colours.iter() {
            let colour = *colour;
            if node.is(Class(colour)) {
                target_bins.push_str(colour);
                target_bins.push_str(" ");
            }
        }
    }
    
    // And we're done!
    println!("Date: {} | Bins: {}", collection_date, target_bins);
}

